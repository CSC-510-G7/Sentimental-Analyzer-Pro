
<!DOCTYPE html>
<html>
{% load static %}
<head lang="en">
  <meta charset="UTF-8">
  <title>S.A.P</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="{% static 'css/bg.css' %}">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="stylesheet" href="{% static 'css/dynamic.css' %}">
  <link rel="stylesheet" href="{% static 'css/nemina.css' %}">
  <link rel="stylesheet" href="{% static 'css/header.css' %}">
  <link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}">
  <link href="{% static 'css/animate.css' %}" rel="stylesheet" type="text/css">
  <style>
    .section-heading-history {
      background: #fbe3d8;
      border-left: 5px solid #e0674e;
      padding: 20px;
      margin-bottom: 25px;
      border-radius: 10px;
    }
    .section-title {
      color: #e0674e;
      font-size: 1.8rem;
      margin-bottom: 10px;
      margin-left: 40%;
    }
    .history-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      background: #fff;
      border: 1px solid #eee;
      padding: 14px 20px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      margin-bottom: 12px;
      max-width: 850px;
      margin-left: auto;
      margin-right: auto;
      gap: 20px;
    }
    .history-card-content {
      display: flex;
      flex-direction: column;
      flex: 1;
    }
    .history-date {
      font-weight: bold;
      font-size: 0.95rem;
      color: #444;
    }
    .history-text {
      color: #666;
      font-size: 0.9rem;
      margin-top: 6px;
      font-style: italic;
    }
    .sentiment-badge {
      display: inline-block;
      padding: 4px 10px;
      font-size: 0.85rem;
      border-radius: 20px;
      font-weight: bold;
      margin-top: 6px;
      width: fit-content;
    }
    .positive {
      background-color: #c2f0c2;
      color: #267326;
    }
    .neutral {
      background-color: #ffeaa7;
      color: #b37400;
    }
    .negative {
      background-color: #ffcccc;
      color: #cc0000;
    }
    .view-btn {
      background-color: #e0674e;
      color: white;
      padding: 6px 12px;
      text-decoration: none;
      border-radius: 4px;
      font-weight: 600;
      white-space: nowrap;
    }
    .history-item:hover {
      background: #f4c5b7;
      transform: translateY(-2px);
    }
    #about {
      margin-bottom: 10px;
    }
    .main-heading {
      color: #e0674e;
      font-size: 2rem;
      margin-bottom: 10px;
      text-align: center;
      font: normal 42px Verdana, Arial, sans-serif;
    }
    @media (max-width: 768px) {
      .section-heading-history {
        padding: 12px;
      }
      .section-title {
        font-size: 1.4rem;
      }
      .history-item {
        flex-direction: column;
        align-items: stretch;
      }
      .view-btn {
        align-self: flex-start;
        margin-top: 10px;
      }
    }
  </style>
</head>
<body>
<div id="wrapper">
  {% include 'realworld/header.html' %}
  <main id="content" class="bgcol">
    <section id="about" class="scrollto clearfix">
      <div class="row clearfix">
        <div class="col-1">
          <h2 class="main-heading">Sentiment History</h2>
        </div>
      </div>
    </section>

    {% for section, records in history_data.items %}
      {% if records %}
      <section id="{{ section|slugify }}" class="scrollto clearfix">
        <div class="row no-padding-bottom clearfix">
          <div class="col-1">
            <div class="section-heading-history">
              <h2 class="section-title">
                {% if section == 'Text_Analysis' %}Text Analysis
                {% elif section == 'Doc_Analysis' %}Document Analysis
                {% elif section == 'Live_Speech' %}Live Speech Analysis
                {% elif section == 'Product_Analysis' %}Product Analysis
                {% elif section == 'Image_Analysis' %}Image Analysis
                {% elif section == 'News_Analysis' %}News Analysis
                {% elif section == 'Audio_Analysis' %}Audio Analysis
                {% elif section == 'Facebook' %}Facebook Analysis
                {% elif section == 'Twitter' %}Twitter Analysis
                {% elif section == 'Reddit' %}Reddit Analysis
                {% else %}{{ section }}
                {% endif %}
              </h2>
              <ol class="history-list">
                {% for timestamp, data in records.items %}
                {% with sentiment=data.sentiment %}
                <li class="history-item">
                  <div class="history-card-content">
                    <span class="history-date">
                      {{ data.formatted_time|default:timestamp }}
                    </span>

                    {% if sentiment.pos > sentiment.neu and sentiment.pos > sentiment.neg %}
                      <span class="sentiment-badge positive">üòä Positive</span>
                    {% elif sentiment.neg > sentiment.pos and sentiment.neg > sentiment.neu %}
                      <span class="sentiment-badge negative">üòû Negative</span>
                    {% else %}
                      <span class="sentiment-badge neutral">üòê Neutral</span>
                    {% endif %}

                    {% if data.text %}
                      <span class="history-text">
                        {{ data.text.0|default:data.text|truncatechars:80 }}
                      </span>
                    {% else %}
                      <span class="history-text">No content preview available</span>
                    {% endif %}
                  </div>

                  {% if section == 'Text_Analysis' %}
                    <a class="view-btn" href="{% url 'text_history_detail' timestamp=timestamp %}">View</a>
                  {% elif section == 'Doc_Analysis' %}
                    <a class="view-btn" href="{% url 'document_history_detail' timestamp=timestamp %}">View</a>
                  {% elif section == 'Live_Speech' %}
                    <a class="view-btn" href="{% url 'live_history_detail' timestamp=timestamp %}">View</a>
                  {% elif section == 'Product_Analysis' %}
                    <a class="view-btn" href="{% url 'product_history_detail' timestamp=timestamp %}">View</a>
                  {% elif section == 'Image_Analysis' %}
                    <a class="view-btn" href="{% url 'image_history_detail' timestamp=timestamp %}">View</a>
                  {% elif section == 'News_Analysis' %}
                    <a class="view-btn" href="{% url 'news_history_detail' timestamp=timestamp %}">View</a>
                  {% elif section == 'Audio_Analysis' %}
                    <a class="view-btn" href="{% url 'audio_history_detail' timestamp=timestamp %}">View</a>
                  {% elif section == 'Facebook' %}
                    <a class="view-btn" href="{% url 'facebook_history_detail' timestamp=timestamp %}">View</a>
                  {% elif section == 'Twitter' %}
                    <a class="view-btn" href="{% url 'twitter_history_detail' timestamp=timestamp %}">View</a>
                  {% elif section == 'Reddit' %}
                    <a class="view-btn" href="{% url 'reddit_history_detail' timestamp=timestamp %}">View</a>
                  {% endif %}
                </li>
                {% endwith %}
                {% endfor %}
              </ol>
            </div>
          </div>
        </div>
      </section>
      {% endif %}
    {% endfor %}
  </main>
  {% include 'realworld/footer.html' %}
</div>
</body>
</html>
